<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" meta name="viewport" content="width=device-width, 
    initial-scale=1.0">
    <link 
    rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" 
    integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" 
    crossorigin="anonymous" 
    referrerpolicy="no-referrer" 
    />
    <title>Yemek Sepeti - Online Yemek Siparişi</title>
<link rel="stylesheet" href="styles/style.css" />
<link rel="stylesheet" href="styles/auth-nav.css" />
<link rel="stylesheet" href="styles/auth-button.css" />
<style>
/* Cart count badge */
.cart-count {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff6b6b;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 0.7rem;
    font-weight: bold;
    min-width: 18px;
    text-align: center;
    z-index: 10;
}

#cart-btn {
    position: relative;
}

/* Cart total styling */
.cart-total {
    padding: 1rem;
    border-top: 1px solid #eee;
    background: #f8f9fa;
    margin-top: 1rem;
}

.cart-total h3 {
    text-align: center;
    color: #27ae60;
    font-size: 1.2rem;
    margin: 0;
}

/* Header buttons düzeni */
.header .buttons {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.header .buttons button {
    background: none;
    border: none;
    color: var(--black);
    font-size: 2.5rem;
    cursor: pointer;
    transition: color 0.3s;
    padding: 0.5rem;
    margin: 0;
}

.header .buttons button:hover {
    color: var(--main-color);
}

/* Auth butonları için özel styling */
#login-btn, #logout-btn {
    font-size: 2rem !important;
    padding: 0.5rem !important;
}

/* Responsive düzenlemeler */
@media (max-width: 991px) {
    .header .buttons {
        gap: 0.3rem;
    }
    
    .header .buttons button {
        font-size: 2rem;
        padding: 0.3rem;
    }
}

@media (max-width: 768px) {
    .header .buttons button {
        font-size: 1.8rem;
        padding: 0.2rem;
    }
    
    .cart-count {
        font-size: 0.6rem;
        padding: 1px 4px;
        min-width: 15px;
    }
}
</style>
</head>
<body>
    <!--! header section start -->
<header class="header">
    <a href="#" class="logo">
        <img src="images/logo.png" alt="logo" />
    </a>
    <nav class="navbar">
        <a href="#home" class="active">Ana Sayfa</a>
        <a href="#about">Hakkımızda</a>
        <a href="#menu">Menü</a>
        <a href="#products">Ürünler</a>
        <a href="#review">Yorumlar</a>
        <a href="orders.html" id="orders-link" style="display: none;">Siparişlerim</a>
        <a href="#contact">İletişim</a>
        <a href="#blogs">Blog</a>  
    </nav>
    
        <div class="buttons">
        <button id="search-btn"> 
            <i class="fas fa-search"></i>
        </button>
        <button id="cart-btn">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count" class="cart-count" style="display: none;">0</span>
        </button>
        <button id="login-btn" style="display: none;">
            <i class="fas fa-sign-in-alt"></i>
        </button>
        <button id="profile-btn" style="display: none;">
            <i class="fas fa-user"></i>
        </button>
        <button id="logout-btn" style="display: none;">
            <i class="fas fa-sign-out-alt"></i>
        </button>
        <button id="menu-btn">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <div class="search-form">
        <input 
        type="text" 
        class="search-input" 
        id="search-box" 
        placeholder="search here">
        <i class="fas fa-search"></i>
    </div>

    <div class="cart-items-container">
        <div id="cart-items">
            <!-- Sepet ürünleri buraya dinamik eklenecek -->
        </div>
        <div class="cart-total" id="cart-total" style="display: none;">
            <h3>Toplam: ₺<span id="total-amount">0.00</span></h3>
        </div>
        <a href="#" class="btn" id="checkout-btn" style="display: none;" onclick="goToCheckout()">Sipariş Ver</a>
    </div>
</header>
    <!-- header section end -->

    <!-- home section start -->
    <section class="home" id="home">
        <div class="content">
            <h3>Lezzetin Adresi!</h3>
            <p>En taze malzemelerle hazırlanan özel lezzetlerimizi keşfedin. Hızlı teslimat ile kapınıza kadar getiriyoruz!
            </p>
            <a href="#menu" class="btn">Sipariş Ver</a>
        </div>
    </section>
    <!-- home section end -->

    <!-- menu section start -->
    <section class="menu" id="menu">
        <h1 class="heading">popüler <span>lezzetlerimiz</span></h1>
        <div class="menu-grid">
            <!-- Bu alan dinamik olarak doldurulacak -->
            <div class="loading-message" style="text-align: center; padding: 3rem; color: #666; background: white; border-radius: 2rem; grid-column: 1 / -1;">
                <i class="fas fa-spinner fa-spin"></i> Lezzetler yükleniyor...
            </div>
        </div>
    </section>
    <!-- menu section end -->

     <!-- products section start --> 
     <section class="products" id="products">
        <h1 class="heading">bizim <span>ürünlerimiz</span></h1>
        <div class="box-container">
            <!-- Dinamik ürünler buraya yüklenecek -->
            <div class="loading-message" style="text-align: center; padding: 2rem; color: #666; background: white; border-radius: 2rem;">
                <i class="fas fa-spinner fa-spin"></i> Ürünler yükleniyor...
            </div>
        </div>
     </section>
     <!-- products section end -->

     <!-- about section start -->
     <section class="about" id="about">
        <h1 class="heading">bizim <span>hakkımızda</span></h1>
        <div class="row">
            <div class="image">
                <img src="images/about.jpg" alt="about">
            </div>
            <div class="content">
                <h3>What Is The Secrect Recipe Of Our Burgers?</h3>
                <p>Lorem Ipsum, Dolor Sit Amet Consectetur Adipisicing Elit. Quisquam Voluptatem Facere Amet Temporibus Culpa Sit Illo Earum Cupiditate Soluta Perferendis!
                </p>
                <p>Lorem Ipsum, Dolor Sit Amet Consectetur Adipisicing Elit. Quisquam Voluptatem Facere Amet Temporibus Culpa Sit Illo Earum Cupiditate Soluta Perferendis!
                </p>
                <p>Lorem Ipsum, Dolor Sit Amet Consectetur Adipisicing Elit. Quisquam Voluptatem Facere Amet Temporibus Culpa Sit Illo Earum Cupiditate Soluta Perferendis!
                </p>
                <a href="#" class="btn">learn more</a>
            </div>
        </div>
     </section>
     <!-- about section end -->

     <!-- review section start -->
     <section class="review" id="review">
        <h1 class="heading">müşteri <span>yorumları</span></h1>
        <div class="box-container">
            <!-- Dinamik yorumlar buraya yüklenecek -->
            <div class="loading-message" style="text-align: center; padding: 2rem; color: #666; background: white; border-radius: 2rem;">
                <i class="fas fa-spinner fa-spin"></i> Yorumlar yükleniyor...
            </div>
        </div>
     </section>
     <!-- review section end -->

     <!-- contact section start -->
     <section class="contact" id="contact">
        <h1 class="heading">bizimle <span>iletişime geçin</span></h1>
        <div class="row">
            <iframe 
            class="map"
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d12037.852231349814!2d28.985091699999998!3d41.03700175!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14cab7650656bd63%3A0x8ca058b28c20b6c3!2zVGFrc2ltIE1leWRhbsSxLCDFnmVoaXQgTXVodGFyLCAzNDQzNSBCZXlvxJ9sdS_EsHN0YW5idWw!5e0!3m2!1str!2str!4v1692864732188!5m2!1str!2str" 
             loading="lazy" 
             referrerpolicy="no-referrer-when-downgrade"
             ></iframe>
             <form>
                <h3>get in touch</h3>
                <div class="inputBox">
                    <i class="fas fa-user"></i>
                    <input type="text" placeholder="name-surname">
                </div>
                <div class="inputBox">
                    <i class="fas fa-user"></i>
                    <input type="email" placeholder="e-mail adress">
                </div>
                <div class="inputBox">
                    <i class="fas fa-phone"></i>
                    <input type="number" placeholder="phone-number">
                </div>
                <input type="submit" class="btn" value="contact now">
             </form>
        </div>
     </section>
     <!-- contact section end -->

     <!-- blogs section start -->
     <section class="blogs" id="blogs">
        <h1 class="heading">bizim <span>bloglarımız</span></h1>
        <div class="box-container">
            <div class="box">
                <div class="image">
                <img src="images/blog-1.jpg" alt="blog">
            </div>
            <div class="content">
                <a href="#" class="title">how to make burgers?</a>
                <span>by admin / 10st may, 2025</span>
                <p>Lorem Ipsum Dolor Sit Amet Consectetur, Adipisicing Elit.
                    Temporibus, Laudamtium!
                </p>
                <a href="#" class="btn">read more</a>
            </div>
        </div>
        <div class="box">
            <div class="image">
            <img src="images/blog-2.jpg" alt="blog">
        </div>
        <div class="content">
            <a href="#" class="title">how to make burgers?</a>
            <span>by admin / 10st may, 2025</span>
            <p>Lorem Ipsum Dolor Sit Amet Consectetur, Adipisicing Elit.
                Temporibus, Laudamtium!
            </p>
            <a href="#" class="btn">read more</a>
        </div>
    </div>
    <div class="box">
        <div class="image">
        <img src="images/blog-3.jpg" alt="blog">
    </div>
    <div class="content">
        <a href="#" class="title">how to make burgers?</a>
        <span>by admin / 10st may, 2025</span>
        <p>Lorem Ipsum Dolor Sit Amet Consectetur, Adipisicing Elit.
            Temporibus, Laudamtium!
        </p>
        <a href="#" class="btn">read more</a>
    </div>
</div>
        </div>
     </section>
     <!-- blogs section end -->

     <!-- footer section start -->
     <section class="footer">
        <div class="search">
            <input type="text" 
            class="search-input" 
            placeholder="Search">
            <button class="btn btn-primary">search</button>
        </div>
        <div class="share">
            <a href="#" class="fab fa-facebook"></a>
            <a href="#" class="fab fa-twitter"></a>
            <a href="#" class="fab fa-instagram"></a>
            <a href="#" class="fab fa-linkedin"></a>
            <a href="#" class="fab fa-pinterest"></a>
        </div>

        <div class="links">
            <a href="index.html"class="active">Home</a>
            <a href="about.html">About</a>
            <a href="menu.html">Menu</a>
            <a href="products.html">Products</a>
            <a href="review.html">Review</a>
            <a href="contact.html">Contact</a>
            <a href="blog.html">Blogs</a>  
        </div>

       <div class="credit">
        created by <span>Batuhan Dündar</span> | all rights reserved
       </div> 
     </section>
     <!-- footer section end -->

         <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase CDN yüklendikten sonra global object'i kaydet
        window.supabaseJs = window.supabase;
        delete window.supabase; // Çakışmayı önle
    </script>
    <script src="js/supabase.js"></script>
    <script>

        // Sepet yönetimi
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        let cartTotal = 0;

        // Sepete ürün ekle
        // Checkout sayfasına git
        function goToCheckout() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            if (cart.length === 0) {
                alert('Sepetiniz boş! Önce ürün ekleyin.');
                return;
            }
            window.location.href = 'checkout.html';
        }

        async function addToCart(productId) {
            try {
                const { data: product } = await supabase
                    .from('products')
                    .select('*')
                    .eq('id', productId)
                    .single();

                if (!product) throw new Error('Ürün bulunamadı');

                const cartItem = cart.find(item => item.id === productId);
                if (cartItem) {
                    cartItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }

                updateCart();
                alert('Ürün sepete eklendi!');
            } catch (error) {
                console.error('Sepete ekleme hatası:', error);
                alert('Ürün sepete eklenirken bir hata oluştu');
            }
        }

        // Sepetten ürün çıkar
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCart();
        }

        // Sepeti güncelle
        function updateCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartTotalContainer = document.getElementById('cart-total');
            const checkoutBtn = document.getElementById('checkout-btn');
            const totalAmountSpan = document.getElementById('total-amount');
            
            cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            // Sepeti localStorage'a kaydet
            localStorage.setItem('cart', JSON.stringify(cart));

            // Sepet ürünlerini güncelle
            if (cart.length > 0) {
                cartItemsContainer.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <i class="fas fa-times" onclick="removeFromCart('${item.id}')"></i>
                        <img src="${item.image_url}" alt="${item.name}">
                        <div class="content">
                            <h3>${item.name}</h3>
                            <div class="price">₺${item.price} x ${item.quantity}</div>
                        </div>
                    </div>
                `).join('');
                
                // Toplam ve checkout butonunu göster
                totalAmountSpan.textContent = cartTotal.toFixed(2);
                cartTotalContainer.style.display = 'block';
                checkoutBtn.style.display = 'block';
            } else {
                cartItemsContainer.innerHTML = '<p style="text-align: center; padding: 1rem;">Sepetiniz boş</p>';
                cartTotalContainer.style.display = 'none';
                checkoutBtn.style.display = 'none';
            }
            
            // Sepet sayısını güncelle
            const cartCount = document.getElementById('cart-count');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (totalItems > 0) {
                cartCount.textContent = totalItems;
                cartCount.style.display = 'inline-block';
            } else {
                cartCount.style.display = 'none';
            }
        }

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Menü ürünlerini getir
                // Tüm kategorileri ve ürünleri getir
                const { data: categories } = await supabase
                    .from('categories')
                    .select('*');

                const { data: allProducts } = await supabase
                    .from('products')
                    .select('*, categories(name)')
                    .eq('is_available', true)
                    .limit(9); // İlk 9 ürünü göster

                // Menü bölümünü güncelle - tüm ürünler
                document.querySelector('.menu-grid').innerHTML = allProducts.map(item => `
                    <div class="menu-item">
                        <img src="${item.image_url}" alt="${item.name}" class="menu-item-image">
                        <div class="menu-item-content">
                            <div class="menu-item-category">${item.categories?.name || 'Ürün'}</div>
                            <h3 class="menu-item-title">${item.name}</h3>
                            <p class="menu-item-description">${item.description}</p>
                            <div class="menu-item-footer">
                                <span class="menu-item-price">₺${item.price}</span>
                                <button class="menu-item-btn" onclick="addToCart('${item.id}')">Sepete Ekle</button>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Tüm ürünleri getir - products section için
                const { data: allProductsForSection } = await supabase
                    .from('products')
                    .select('*, categories(name)')
                    .eq('is_available', true)
                    .limit(12); // Daha fazla ürün göster

                // Ürünler bölümünü güncelle
                document.querySelector('.products .box-container').innerHTML = allProductsForSection.map(item => `
                    <div class="box">
                        <img src="${item.image_url}" alt="${item.name}">
                        <div class="box-head">
                            <span class="title">${item.categories?.name || 'Ürün'}</span>
                            <a href="#" class="name">${item.name}</a>
                        </div>
                        <div class="box-bottom">
                            <div class="info">
                                <b class="price">₺${item.price}</b>
                                <span class="amount">${item.description}</span>
                            </div>
                            <div class="product-btn">
                                <a href="#" onclick="addToCart('${item.id}')"><i class="fas fa-shopping-cart"></i></a>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Yorumları getir
                // Yorumları al - basit sorgu
                const { data: reviews } = await supabase
                    .from('reviews')
                    .select('*')
                    .limit(3);

                // Yorumlar bölümünü güncelle
                if (reviews && reviews.length > 0) {
                    document.querySelector('.review .box-container').innerHTML = reviews.map(review => `
                    <div class="box">
                        <img src="images/quote.png" alt="quote">
                        <p>${review.comment}</p>
                        <img src="images/avatar-1.png" alt="avatar" class="user">
                        <h3>Müşteri</h3>
                        <div class="stars">
                            ${Array(review.rating).fill('<i class="fas fa-star"></i>').join('')}
                            ${review.rating < 5 ? '<i class="fas fa-star-half-alt"></i>' : ''}
                        </div>
                    </div>
                `).join('');
                } else {
                    // Eğer yorum yoksa varsayılan yorumlar göster
                    document.querySelector('.review .box-container').innerHTML = `
                        <div class="box">
                            <img src="images/quote.png" alt="quote">
                            <p>Harika lezzetler, hızlı teslimat! Kesinlikle tavsiye ederim.</p>
                            <img src="images/avatar-1.png" alt="avatar" class="user">
                            <h3>Ahmet K.</h3>
                            <div class="stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                        <div class="box">
                            <img src="images/quote.png" alt="quote">
                            <p>Pizza çok lezzetliydi, tekrar sipariş vereceğim.</p>
                            <img src="images/avatar-2.png" alt="avatar" class="user">
                            <h3>Fatma S.</h3>
                            <div class="stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                        <div class="box">
                            <img src="images/quote.png" alt="quote">
                            <p>Burgerler mükemmel, herkese tavsiye ederim!</p>
                            <img src="images/avatar-3.png" alt="avatar" class="user">
                            <h3>Mehmet Y.</h3>
                            <div class="stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Veri yükleme hatası:', error);
            }
        });

        // Auth durumu kontrolü ve buton yönetimi
        async function updateAuthUI() {
            const loginBtn = document.getElementById('login-btn');
            const profileBtn = document.getElementById('profile-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const ordersLink = document.getElementById('orders-link');

            try {
                if (window.supabase) {
                    const { data: { session } } = await window.supabase.auth.getSession();
                    
                    if (session) {
                        // Kullanıcı giriş yapmış
                        loginBtn.style.display = 'none';
                        profileBtn.style.display = 'inline-block';
                        logoutBtn.style.display = 'inline-block';
                        ordersLink.style.display = 'inline-block';
                        
                        // Admin kontrolü
                        const { data: profile } = await window.supabase
                            .from('profiles')
                            .select('is_admin')
                            .eq('id', session.user.id)
                            .single();

                        profileBtn.onclick = () => {
                            if (profile?.is_admin) {
                                window.location.href = 'admin.html';
                            } else {
                                window.location.href = 'profile.html';
                            }
                        };
                    } else {
                        // Kullanıcı giriş yapmamış
                        loginBtn.style.display = 'inline-block';
                        profileBtn.style.display = 'none';
                        logoutBtn.style.display = 'none';
                        ordersLink.style.display = 'none';
                        
                        loginBtn.onclick = () => {
                            window.location.href = 'login.html';
                        };
                    }
                } else {
                    // Supabase yüklenmemiş - varsayılan durum
                    loginBtn.style.display = 'inline-block';
                    profileBtn.style.display = 'none';
                    logoutBtn.style.display = 'none';
                    
                    loginBtn.onclick = () => {
                        window.location.href = 'login.html';
                    };
                }

                // Çıkış butonu
                logoutBtn.onclick = async () => {
                    try {
                        if (window.supabase) {
                            await window.supabase.auth.signOut();
                        }
                        localStorage.removeItem('isAdmin');
                        window.location.reload();
                    } catch (error) {
                        console.error('Çıkış hatası:', error);
                    }
                };

            } catch (error) {
                console.error('Auth UI güncelleme hatası:', error);
                // Hata durumunda giriş butonu göster
                loginBtn.style.display = 'inline-block';
                profileBtn.style.display = 'none';
                logoutBtn.style.display = 'none';
                ordersLink.style.display = 'none';
            }
        }

        // Sayfa yüklendiğinde auth durumunu kontrol et
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(updateAuthUI, 1000); // Supabase yüklenmesini bekle
            updateCart(); // Sepeti güncelle
        });

    </script>
    <script src="js/script.js"></script>
</body>
</html>