<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profilim - Yemek Sepeti</title>
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="styles/auth-nav.css">
    <link rel="stylesheet" href="styles/auth-button.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .profile-container {
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .profile-container h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
            border-bottom: 2px solid #f3f3f3;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #ff4b4b;
            outline: none;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #ff4b4b;
            color: white;
            margin-right: 10px;
        }

        .btn-danger {
            background: #333;
            color: white;
        }

        .btn-primary:hover {
            background: #ff3333;
        }

        .btn-danger:hover {
            background: #222;
        }

        #userEmail {
            font-weight: 500;
            color: #ff4b4b;
        }

        #lastUpdate {
            color: #666;
            font-size: 14px;
        }

        body {
            background: #f7f7f7;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
    </style>
</head>
<body>
    <!--! header section start -->
    <header class="header">
        <a href="#" class="logo">
            <img src="images/logo.png" alt="logo" />
        </a>
        <nav class="navbar">
            <a href="index.html">Ana Sayfa</a>
            <a href="index.html#menu.html">Menü</a>
            <a href="products.html">Ürünler</a>
            <a href="review.html">Yorumlar</a>
            <a href="orders.html">Siparişlerim</a>
            <a href="contact.html">İletişim</a>
            <a href="blogs.html">Blog</a>  
        </nav>
        
        <div class="buttons">
            <button id="search-btn"> 
                <i class="fas fa-search"></i>
            </button>
            <button id="cart-btn">
                <i class="fas fa-shopping-cart"></i>
            </button>
            <button id="menu-btn">
                <i class="fas fa-bars"></i>
            </button>
            <button id="profile-btn" class="active">
                <i class="fas fa-user"></i>
            </button>
        </div>

        <div class="search-form">
            <input 
            type="text" 
            class="search-input" 
            id="search-box" 
            placeholder="search here">
            <i class="fas fa-search"></i>
        </div>

        <div class="cart-items-container">
            <div class="cart-item">
                <i class="fas fa-times"></i>
                <img src="images/menu-1.png" alt="menu">
                <div class="content">
                   <h3>cart item 01</h3>
                   <div class="price">$15.99/-</div>
                </div>
            </div>
            <div class="cart-item">
                <i class="fas fa-times"></i>
                <img src="images/menu-2.png" alt="menu">
                <div class="content">
                   <h3>cart item 02</h3>
                   <div class="price">$15.99/-</div>
                </div>
            </div>
            <div class="cart-item">
                <i class="fas fa-times"></i>
                <img src="images/menu-3.png" alt="menu">
                <div class="content">
                   <h3>cart item 03</h3>
                   <div class="price">$15.99/-</div>
                </div>
            </div>
            <div class="cart-item">
                <i class="fas fa-times"></i>
                <img src="images/menu-4.png" alt="menu">
                <div class="content">
                   <h3>cart item 04</h3>
                   <div class="price">$15.99/-</div>
                </div>
            </div>
                <a href="#" class="btn">checkout now</a>
        </div>
    </header>
    <!-- header section end -->

    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar">
                <i class="fas fa-user-circle"></i>
            </div>
            <div class="profile-info">
                <h2>Profil Bilgileri</h2>
                <p class="email-text">Email: <span id="userEmail"></span></p>
                <p class="update-text">Son Güncelleme: <span id="lastUpdate">-</span></p>
            </div>
        </div>

        <div class="profile-form">
            <div class="form-group">
                <label for="fullName">
                    <i class="fas fa-user"></i>
                    Ad Soyad
                </label>
                <input type="text" id="fullName" name="fullName" placeholder="Ad Soyad giriniz">
            </div>
            
            <div class="form-group">
                <label for="phone">
                    <i class="fas fa-phone"></i>
                    Telefon
                </label>
                <input type="tel" id="phone" name="phone" placeholder="Telefon numarası giriniz">
            </div>
            
            <div class="form-group">
                <label for="address">
                    <i class="fas fa-map-marker-alt"></i>
                    Adres
                </label>
                <textarea id="address" name="address" placeholder="Adres giriniz"></textarea>
            </div>
        </div>
        
        <div class="profile-actions">
            <button id="saveProfile" class="btn-save">
                <i class="fas fa-save"></i>
                Kaydet
            </button>
            <button id="signOut" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i>
                Çıkış Yap
            </button>
        </div>
    </div>

    <style>
        .profile-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .profile-avatar {
            font-size: 4rem;
            color: #ff4b4b;
            margin-right: 1.5rem;
        }

        .profile-info h2 {
            margin: 0;
            color: #333;
            font-size: 1.8rem;
        }

        .email-text {
            color: #666;
            margin: 0.5rem 0;
        }

        .update-text {
            color: #999;
            font-size: 0.9rem;
            margin: 0;
        }

        .profile-form {
            margin: 2rem 0;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: flex;
            align-items: center;
            color: #555;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group label i {
            margin-right: 0.5rem;
            color: #ff4b4b;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #ff4b4b;
            outline: none;
            box-shadow: 0 0 0 3px rgba(255,75,75,0.1);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .profile-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid #f0f0f0;
        }

        .btn-save,
        .btn-logout {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-save {
            background: #ff4b4b;
            color: white;
            flex: 2;
        }

        .btn-logout {
            background: #333;
            color: white;
            flex: 1;
        }

        .btn-save:hover {
            background: #ff3333;
        }

        .btn-logout:hover {
            background: #222;
        }

        .btn-save i,
        .btn-logout i {
            margin-right: 0.5rem;
        }

        @media (max-width: 768px) {
            .profile-container {
                margin: 1rem;
                padding: 1rem;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .profile-avatar {
                margin: 0 0 1rem 0;
            }

            .profile-actions {
                flex-direction: column;
            }

            .btn-save,
            .btn-logout {
                width: 100%;
            }
        }
    </style>

    <script>
        // Supabase bağlantısı
        const SUPABASE_URL = 'https://rwobzqpedtphuxvkzkbq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ3b2J6cXBlZHRwaHV4dmt6a2JxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4MDU3MjYsImV4cCI6MjA2OTM4MTcyNn0.ga3lHSx8ufgCtXcpC7cuQZ4PcJurUhXdPNh3gKFNj0U';

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Supabase istemcisini oluştur
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

                // Auth kontrolü
                const { data: { session }, error: authError } = await supabase.auth.getSession();
                if (!session) {
                    window.location.href = 'login.html';
                    return;
                }

                const user = session.user;

                // Kullanıcı bilgilerini göster
                document.getElementById('userEmail').textContent = user.email;
                
                // Profil bilgilerini çek
                const { data: profile, error: profileError } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', user.id)
                    .single();
                
                if (profileError) throw profileError;

                if (profile) {
                    document.getElementById('fullName').value = profile.full_name || '';
                    document.getElementById('phone').value = profile.phone || '';
                    document.getElementById('address').value = profile.address || '';
                    
                    if (profile.updated_at) {
                        document.getElementById('lastUpdate').textContent = 
                            new Date(profile.updated_at).toLocaleString('tr-TR');
                    }
                }

                // Profil güncelleme butonu
                document.getElementById('saveProfile').onclick = async () => {
                    const button = document.getElementById('saveProfile');
                    const originalText = button.innerHTML;
                    
                    try {
                        button.disabled = true;
                        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Kaydediliyor...';

                        const { error: updateError } = await supabase
                            .from('profiles')
                            .upsert({
                                id: user.id,
                                full_name: document.getElementById('fullName').value,
                                phone: document.getElementById('phone').value,
                                address: document.getElementById('address').value,
                                updated_at: new Date().toISOString()
                            });

                        if (updateError) throw updateError;

                        alert('Profil başarıyla güncellendi!');
                        window.location.reload();

                    } catch (error) {
                        console.error('Güncelleme hatası:', error);
                        alert('Profil güncellenirken bir hata oluştu');
                    } finally {
                        button.disabled = false;
                        button.innerHTML = originalText;
                    }
                };

                // Çıkış yapma butonu
                document.getElementById('signOut').onclick = async () => {
                    try {
                        const { error } = await supabase.auth.signOut();
                        if (error) throw error;
                        window.location.href = 'index.html';
                    } catch (error) {
                        console.error('Çıkış hatası:', error);
                        alert('Çıkış yapılırken bir hata oluştu');
                    }
                };

            } catch (error) {
                console.error('Veri yükleme hatası:', error);
                alert('Bilgiler yüklenirken bir hata oluştu.');
            }
        });
    </script>
    <script src="js/script.js"></script>
</body>
</html>